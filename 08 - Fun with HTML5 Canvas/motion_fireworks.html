<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>HTML5 Canvas</title>
</head>

<body>
  <canvas id="draw" width="800" height="600"></canvas>


  <style>
    html,
    body {
      margin: 0;
      text-align: center;
    }

    #draw {
      border: 1px solid #000;
      margin: 10px auto;
      display: block;
      background: rgb(2, 4, 30);
      cursor: crosshair;
    }
  </style>
  <script>
    const canvas = document.querySelector('#draw');
    const ctx = canvas.getContext('2d');
    let target = {
      x: canvas.width / 2,
      y: canvas.height
    };
    let balls = [];
    let gravity = -0.05;
    let circleBalls = [];

    function draw() {
      //開始發射的球
      balls.forEach((item, index) => {

        //接近目標時越變越淡
        let distance = item.target.y - item.position.y;
        item.alpha = Math.min((distance * distance / 10000 * item.fade), 1);

        let velY  = item.velocity * Math.sin(item.angle) / 10;
        let velX = item.velocity * Math.cos(item.angle) / 10;
        item.position.x += velX;
        item.position.y -= velY;

        ctx.fillStyle = `hsla(${item.color},100%,60%,${item.alpha})`;
        ctx.beginPath();
        ctx.arc(item.position.x, item.position.y, item.radius, 0, Math.PI * 2)
        ctx.fill();


        if (item.alpha < 0.0005) {
          balls.splice(index,1);
        }
      });
    }
    

   
 

    //繪出煙火球
    function drawFireworks(){

    

    }




    function render() {

      // Gradually fade away
      // ctx.fillStyle = 'rgba(2,4,30,.2)';
      // ctx.fillRect(0, 0, canvas.width, canvas.height);


      canvas.width = canvas.width;
      draw();
      requestAnimationFrame(render);

    }


    canvas.addEventListener('click', (e) => {
      target = {
        x: e.offsetX,
        y: e.offsetY,
      };
      let mx = e.offsetX - canvas.width / 2;
      let my = canvas.height - e.offsetY;
      let color = Math.random() * 360; // hsla 的 h;
      //發射的球
      let ball = {
        position: {
          x: canvas.width / 2,
          y: canvas.height,
        },
        velocity: 4 + Math.random() * 2,
        angle: Math.atan(my / mx),
        alpha: 1,
        fade: 0.5,
        radius: 4,
        target: {
          x: e.offsetX,
        y: e.offsetY,
        },
        color,
      }
   
      //修正方向
      if( mx <0){
        ball.velocity = -ball.velocity;
      }
      balls.push(ball);

      // 煙火球
      let count = 50 + Math.random()*20;
      let circleAngle = Math.PI*2 / count;

      for(let i=0; i< count ; i++){
        let vel = 3 + Math.random() * 4;
        let particleAngle = circleAngle * i;
        let circleBall ={
           life:100,
           position:{
             x:target.x,
             y:target.y
           },
           velocity:{
             x:vel * Math.cos(particleAngle),
             y:vel * Math.sin(particleAngle),
           },
           color,
           radius: 3 + Math.random()*3,
           alpha:1,
        }
        circleBalls.push(circleBall);
      }

     
      render();

    })

    requestAnimationFrame(render);
  </script>


</body>

</html>